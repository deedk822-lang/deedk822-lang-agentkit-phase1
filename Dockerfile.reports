# --------- Report-Generator ---------
FROM python:3.12-slim

# 1. system libraries that reportlab / openpyxl / pandas need
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        libxml2-dev libxslt-dev libffi-dev \
        libcairo2-dev libpango1.0-dev \
        # runtime pixbuf libs (headers not needed)
        libgdk-pixbuf-2.0-0 libgdk-pixbuf-xlib-2.0-0 \
        shared-mime-info \
        # optional: fonts so PDFs donâ€™t fall back to boxes
        fonts-dejavu-core fonts-liberation \
    && rm -rf /var/lib/apt/lists/*

# 2. python dependencies
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 3. application code
COPY . .

# 4. non-root user
RUN useradd -m -u 1001 reporter
USER reporter

CMD ["python", "-m", "report_generator"]
