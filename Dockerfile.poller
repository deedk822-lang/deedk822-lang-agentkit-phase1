# ----------------------------------------------------------
#  Dockerfile for the command-poller agent
#  Build:  docker build -f Dockerfile.poller -t gcr.io/xxx/agentkit-command-poller:latest .
# ----------------------------------------------------------
FROM python:3.12-slim

# ---- security updates ----
RUN apt-get update && apt-get upgrade -y && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# ---- install deps first (better layer caching) ----
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ---- copy source code ----
COPY . /app/

# ---- non-root user for safety ----
RUN useradd -m -u 1000 agent && chown -R agent:agent /app
USER agent

# ---- entry point ----
CMD ["python", "-m", "agents.command_poller"]
